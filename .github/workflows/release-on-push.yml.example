name: Release on Push

# This workflow automatically creates GitHub releases after release PRs are merged
# It triggers on push to branches defined in your release-channels.yml
# This workflow is for PUBLIC repositories that need to use workflows from a PRIVATE repository
# It uses token-based checkout to access the private npm-release-workflows repository
#
# SETUP INSTRUCTIONS:
# 1. Ensure WORKFLOWS_ACCESS_GITHUB_TOKEN secret is configured (see docs/credentials.md)
# 2. Replace 'heroku' with your GitHub organization name
# 3. Replace 'npm-release-workflows' with the actual repository name if different
# 4. Update the branches list to match your release-channels.yml branch names
# 5. Copy this file to .github/workflows/release-on-push.yml in your project
#
# IMPORTANT: The branches in the push trigger MUST match the branch names
# defined in your release-channels.yml file

on:
  push:
    branches:
      # Add all branches that are defined in your release-channels.yml
      # Common examples:
      - main      # Stable releases
      - beta      # Beta/prerelease channel
      # - alpha    # Uncomment if you have an alpha channel
      # Add any other branches defined in your release-channels.yml

jobs:
  create-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4

      - name: Checkout workflows repository
        uses: actions/checkout@v4
        with:
          repository: heroku/npm-release-workflows
          token: ${{ secrets.WORKFLOWS_ACCESS_GITHUB_TOKEN }}
          path: workflows-repo
          ref: main

      - name: Create GitHub Release
        uses: ./workflows-repo/.github/actions/release-on-push-create-release-public
        with:
          # Update package-manager to match your project (npm, yarn, or pnpm)
          # Used for installing dependencies when creating releases
          package-manager: pnpm
          branch_name: ${{ github.ref_name }}

